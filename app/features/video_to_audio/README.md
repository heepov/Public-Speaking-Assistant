# Video to Audio Converter Service

## Описание

Микросервис для конвертации видео файлов в аудио с использованием FFmpeg. Легковесный сервис без GPU зависимостей.

## Ответственность

- **Только конвертация видео в аудио** - сервис принимает только видео файлы
- **Оптимизация для транскрипции** - настройки аудио оптимизированы для WhisperX
- **Пакетная обработка** - поддержка конвертации нескольких файлов
- **Гибкие настройки** - возможность настройки формата, частоты дискретизации, каналов

## Зависимости

- **Входные данные**: Видео файлы (MP4, AVI, MOV, MKV, WMV, FLV)
- **Выходные данные**: Аудио файлы (WAV, MP3, FLAC)
- **Внешние зависимости**: 
  - FFmpeg
  - Python библиотеки для работы с медиа

## API Endpoints

### POST /convert
Конвертация одного видео файла в аудио

**Параметры:**
- `file`: Видео файл
- `task_id`: ID задачи
- `audio_format`: Формат выходного аудио (wav, mp3, flac)
- `sample_rate`: Частота дискретизации (16000)
- `channels`: Количество каналов (1)

### POST /convert/batch
Пакетная конвертация нескольких видео файлов

**Параметры:**
- `files`: Список видео файлов
- `task_id`: ID задачи
- `audio_format`: Формат выходного аудио
- `sample_rate`: Частота дискретизации
- `channels`: Количество каналов

### GET /health
Проверка состояния сервиса

### GET /formats
Информация о поддерживаемых форматах

## Конфигурация

### Переменные окружения
- `PORT`: Порт сервиса (8003)
- `HOST`: Хост сервиса (0.0.0.0)
- `LOG_LEVEL`: Уровень логирования

### Поддерживаемые форматы видео
- MP4
- AVI
- MOV
- MKV
- WMV
- FLV

### Поддерживаемые форматы аудио
- WAV
- MP3
- FLAC

### Оптимальные настройки для транскрипции
- Частота дискретизации: 16000 Hz
- Каналы: 1 (моно)
- Формат: WAV
- Кодек: PCM 16-bit

## Запуск

### Docker
```bash
docker-compose up video-converter
```

### Локально
```bash
cd app/features/video_to_audio
python -m microservice
```

## Архитектура

```
VideoToAudioService
├── FFmpeg Integration
├── Video Analysis
├── Audio Conversion
└── Progress Tracking
```

## Мониторинг

- Health check endpoint для проверки состояния
- Логирование всех операций
- Информация о FFmpeg
- Статистика конвертации

## Безопасность

- Проверка форматов файлов
- Валидация входных данных
- Ограничение размера файлов
- Изоляция процессов

## Интеграция с Transcription Service

Этот сервис работает в паре с Transcription Service:

1. **Video Converter** конвертирует видео в аудио
2. **Transcription Service** транскрибирует полученное аудио

### Пример workflow:
```
Video File → Video Converter → Audio File → Transcription Service → Text
```

## Производительность

- Легковесный контейнер без GPU зависимостей
- Быстрая конвертация с помощью FFmpeg
- Поддержка параллельной обработки
- Оптимизированные настройки для транскрипции

## Web-интерфейс для тестирования

Для удобного тестирования сервиса конвертации видео в аудио доступен веб-интерфейс.

### Расположение
```
app/features/video_to_audio/web/index.html
```

### Функциональность
- **Загрузка видео файлов** - поддержка всех форматов (MP4, AVI, MOV, MKV, WMV, FLV, WebM)
- **Настройка параметров аудио** - формат, частота дискретизации, каналы, битрейт
- **Мониторинг состояния** - проверка доступности сервиса и FFmpeg
- **Отображение результатов** - показ информации о конвертации
- **Скачивание результата** - прямая ссылка для скачивания аудио файла
- **Информация о файле** - отображение размера и типа загружаемого файла

### Использование
1. Откройте файл `web/index.html` в браузере
2. Дождитесь подключения к сервису (порт 8003)
3. Выберите видео файл для конвертации
4. Настройте параметры выходного аудио
5. Нажмите "Конвертировать видео в аудио"
6. Получите результат и скачайте аудио файл

### Рекомендуемые настройки для транскрипции
- **Формат**: WAV (лучшее качество)
- **Частота дискретизации**: 16000 Hz (оптимально для WhisperX)
- **Каналы**: 1 (моно)
- **Битрейт**: 128 kbps

### Требования
- Запущенный сервис конвертации на порту 8003
- Современный браузер с поддержкой ES6+
- Доступ к API сервиса (CORS настроен)
