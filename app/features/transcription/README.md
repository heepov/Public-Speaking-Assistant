# Transcription Service

## Описание

Микросервис для транскрипции аудио файлов с использованием WhisperX и GPU ускорения.

## Ответственность

- **Только транскрипция аудио файлов** - сервис принимает только аудио файлы
- **GPU ускорение** - автоматическое использование CUDA для ускорения обработки
- **Кэширование моделей** - сохранение моделей WhisperX между перезапусками
- **Поддержка различных моделей** - tiny, base, small, medium, large-v2, large-v3

## Зависимости

- **Входные данные**: Аудио файлы (WAV, MP3, FLAC, M4A, OGG)
- **Выходные данные**: Текст транскрипции с временными метками
- **Внешние зависимости**: 
  - WhisperX
  - PyTorch с CUDA
  - FFmpeg (для обработки аудио)

## API Endpoints

### POST /transcribe
Транскрипция одного аудио файла

**Параметры:**
- `file`: Аудио файл
- `task_id`: ID задачи
- `model_size`: Размер модели (tiny, base, small, medium, large-v2, large-v3)

### POST /transcribe/batch
Пакетная транскрипция нескольких аудио файлов

**Параметры:**
- `files`: Список аудио файлов
- `task_id`: ID задачи
- `model_size`: Размер модели

### GET /health
Проверка состояния сервиса

### GET /models
Информация о доступных моделях

## Конфигурация

### Переменные окружения
- `WHISPER_MODEL`: Размер модели по умолчанию (base)
- `CUDA_VISIBLE_DEVICES`: GPU устройства для использования
- `WHISPERX_CACHE_DIR`: Директория для кэширования моделей
- `HF_HOME`: HuggingFace кэш
- `TRANSFORMERS_CACHE`: Transformers кэш

### Поддерживаемые форматы аудио
- WAV
- MP3
- FLAC
- M4A
- OGG

## Запуск

### Docker
```bash
docker-compose up transcription-service
```

### Локально
```bash
cd app/features/transcription
python -m microservice
```

## Архитектура

```
TranscriptionService
├── WhisperX Model (GPU/CPU)
├── Alignment Model
├── Audio Processing
└── Result Generation
```

## Мониторинг

- Health check endpoint для проверки состояния
- Логирование всех операций
- Информация о GPU/CPU использовании
- Статистика моделей

## Безопасность

- Проверка форматов файлов
- Валидация входных данных
- Ограничение размера файлов
- Изоляция процессов

## Web-интерфейс для тестирования

Для удобного тестирования сервиса транскрипции доступен веб-интерфейс.

### Расположение
```
app/features/transcription/web/index.html
```

### Функциональность
- **Загрузка аудио файлов** - поддержка всех форматов (MP3, WAV, M4A, FLAC, OGG, AAC)
- **Выбор модели** - настройка размера модели WhisperX (tiny, base, small, medium, large-v2, large-v3)
- **Мониторинг состояния** - проверка доступности сервиса и GPU
- **Отображение результатов** - показ транскрипции с детальной информацией
- **Прогресс-бар** - визуализация процесса обработки

### Использование
1. Откройте файл `web/index.html` в браузере
2. Дождитесь подключения к сервису (порт 8001)
3. Выберите аудио файл для транскрипции
4. Настройте параметры модели
5. Нажмите "Начать транскрипцию"
6. Получите результат с текстом и метаданными

### Требования
- Запущенный сервис транскрипции на порту 8001
- Современный браузер с поддержкой ES6+
- Доступ к API сервиса (CORS настроен)
